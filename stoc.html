<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stoc Live - AutoHuse.md | VerificƒÉ Disponibilitatea (FƒÉrƒÉ Pre»õuri)</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="VerificƒÉ stocul disponibil √Æn timp real pentru husele auto AutoHuse.md. Disponibilitate actualizatƒÉ live pentru toate modelele de ma»ôini.">
    <meta name="keywords" content="stoc huse auto, disponibilitate huse auto, verifica stoc, huse auto moldova, stock live">
    <meta name="author" content="AutoHuse.md">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&display=swap" rel="stylesheet">
    <link rel="icon" href="./assets/img/logo.png">
    <style>
        body { font-family: 'Bricolage Grotesque', system-ui, sans-serif; }
        h1, h2, h3 { font-weight: 800; font-variation-settings: "opsz" 24; }
        .hero-title { font-weight: 900; font-variation-settings: "opsz" 36; }
        .loading-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .stock-item { transition: all 0.3s ease; }
        .stock-item:hover { transform: translateY(-2px); }
        .in-stock { border-left: 4px solid #10b981; }
        .out-of-stock { border-left: 4px solid #ef4444; }
        .low-stock { border-left: 4px solid #f59e0b; }
    </style>
</head>
<body class="bg-white text-slate-800">
    <!-- Navbar -->
    <nav class="sticky top-0 z-40 bg-white shadow-sm">
        <div class="max-w-[1200px] mx-auto px-4 md:px-6">
            <div class="h-16 flex items-center justify-between">
                <!-- Logo -->
                <a href="index.html" class="flex items-center gap-3 hover:opacity-80 transition-opacity">
                    <div class="w-10 h-10 bg-[#F7941E] rounded-full flex items-center justify-center">
                        <img src="assets/img/logo.png" alt="AutoHuse.md - Huse Auto Premium" class="w-full h-full object-contain">
                    </div>
                    <span class="font-semibold text-slate-900">AutoHuse</span>
                </a>

                <!-- Desktop Menu -->
                <div class="hidden md:flex items-center gap-8">
                    <a href="index.html" class="text-slate-700 hover:text-slate-900 transition-colors">AcasƒÉ</a>
                    <a href="masini.html" class="text-slate-700 hover:text-slate-900 transition-colors">Ma»ôini</a>
                    <a href="lucrari.html" class="text-slate-700 hover:text-slate-900 transition-colors">LucrƒÉri</a>
                    <a href="despre.html" class="text-slate-700 hover:text-slate-900 transition-colors">Despre Noi</a>
                    <a href="stoc.html" class="text-slate-700 hover:text-slate-900 transition-colors font-semibold text-slate-900">Stoc Live</a>
                </div>

                <!-- Desktop Contact -->
                <a href="tel:+37360607028" class="hidden md:flex items-center gap-2 hover:opacity-80 transition-opacity">
                    <div class="w-8 h-8 bg-[#F7941E] rounded-full flex items-center justify-center">
                        <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                        </svg>
                    </div>
                    <div>
                        <div class="text-xs text-slate-600">Ajutor?</div>
                        <div class="text-sm font-medium">+373 60607028</div>
                    </div>
                </a>

                <!-- Mobile Menu Button -->
                <button id="mobileMenuBtn" class="md:hidden p-2 rounded-lg hover:bg-slate-100 transition-colors">
                    <svg class="w-6 h-6 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>

            <!-- Mobile Menu -->
            <div id="mobileMenu" class="md:hidden hidden border-t border-slate-200">
                <div class="py-4 space-y-2">
                    <a href="index.html" class="block px-4 py-2 text-slate-700 hover:bg-slate-50 hover:text-slate-900 transition-colors rounded-lg">AcasƒÉ</a>
                    <a href="masini.html" class="block px-4 py-2 text-slate-700 hover:bg-slate-50 hover:text-slate-900 transition-colors rounded-lg">Ma»ôini</a>
                    <a href="lucrari.html" class="block px-4 py-2 text-slate-700 hover:bg-slate-50 hover:text-slate-900 transition-colors rounded-lg">LucrƒÉri</a>
                    <a href="despre.html" class="block px-4 py-2 text-slate-700 hover:bg-slate-50 hover:text-slate-900 transition-colors rounded-lg">Despre Noi</a>
                    <a href="stoc.html" class="block px-4 py-2 text-slate-700 hover:bg-slate-50 hover:text-slate-900 transition-colors rounded-lg font-semibold text-slate-900">Stoc Live</a>
                    <div class="px-4 py-2 border-t border-slate-200 mt-2 pt-4">
                        <a href="tel:+37360607028" class="flex items-center gap-2 hover:opacity-80 transition-opacity">
                            <div class="w-8 h-8 bg-[#F7941E] rounded-full flex items-center justify-center">
                                <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                                </svg>
                            </div>
                            <div>
                                <div class="text-xs text-slate-600">Ajutor?</div>
                                <div class="text-sm font-medium">+373 60607028</div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main>
        <!-- Hero Section -->
        <section class="max-w-[1200px] mx-auto px-4 md:px-6 py-10 md:py-14">
            <div class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-black mb-4">Stoc Live - VerificƒÉ Disponibilitatea</h1>
                <p class="text-lg text-slate-600 mb-4">Informa»õii actualizate √Æn timp real despre disponibilitatea produselor noastre</p>
                
                
                <!-- Live indicator -->
                <div class="flex items-center justify-center gap-2 mb-6">
                    <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                    <span class="text-sm text-slate-600">Actualizat √Æn timp real</span>
                    <span id="lastUpdate" class="text-xs text-slate-500"></span>
                    <span id="mobileIndicator" class="text-xs text-blue-500 hidden md:hidden">üì±</span>
                </div>
                
                <!-- Important Notices -->
                <div class="space-y-4 mb-8 max-w-3xl mx-auto">
                    <div class="bg-orange-50 border border-orange-200 rounded-xl p-4">
                        <div class="flex items-start gap-3">
                            <div class="w-6 h-6 bg-orange-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div>
                                <h4 class="text-orange-800 font-semibold text-sm mb-1">‚è∞ Timp de Livrare</h4>
                                <p class="text-orange-700 text-sm">
                                    <strong>Comenzile din stocul live necesitƒÉ 3-4 sƒÉptƒÉm√¢ni pentru livrare</strong><br>
                                    Produsele sunt comandate special de la furnizor »ôi confec»õionate la dimensiunile exacte ale ma»ôinii dumneavoastrƒÉ.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Controls -->
                <div class="flex flex-col gap-4 mb-8 max-w-4xl mx-auto px-2">
                    <!-- Search Bar -->
                    <div class="flex flex-col sm:flex-row gap-3">
                        <input type="text" id="searchInput" placeholder="CautƒÉ dupƒÉ nume, model sau cod..." 
                               enterkeyhint="search" autocomplete="off" autocapitalize="off" spellcheck="false"
                               class="flex-1 px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#F7941E] focus:border-transparent text-base">
                        <button id="clearSearchBtn" class="hidden px-4 py-3 bg-slate-500 text-white rounded-lg hover:opacity-90 transition-opacity">
                            »òterge cƒÉutarea
                        </button>
                        <button id="refreshBtn" class="px-4 py-3 bg-[#F7941E] text-white rounded-lg hover:opacity-90 transition-opacity flex items-center justify-center gap-2 w-full sm:w-auto sm:min-w-[120px]">
                            <svg id="refreshIcon" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                            </svg>
                            <span class="hidden sm:inline">Re√ÆmprospƒÉteazƒÉ</span>
                            <span class="sm:hidden">Refresh</span>
                        </button>
                    </div>
                    
                </div>
            </div>
        </section>

        <!-- Stock Grid -->
        <section class="max-w-[1200px] mx-auto px-4 md:px-6 pb-10 md:pb-14">
            <!-- Loading State -->
            <div id="loadingState" class="text-center py-12">
                <div class="loading-pulse bg-slate-200 rounded-2xl p-8 mb-4 mx-auto max-w-md">
                    <div class="h-6 bg-slate-300 rounded mb-4"></div>
                    <div class="h-4 bg-slate-300 rounded mb-2"></div>
                    <div class="h-4 bg-slate-300 rounded w-3/4 mx-auto"></div>
                </div>
                <p class="text-slate-600">Se √ÆncarcƒÉ datele despre stoc...</p>
            </div>

            <!-- Error State -->
            <div id="errorState" class="hidden text-center py-12">
                <div class="bg-red-50 border border-red-200 rounded-2xl p-8 max-w-md mx-auto mb-4">
                    <svg class="w-12 h-12 text-red-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L5.268 15.5c-.77.833.192 2.5 1.732 2.5z"/>
                    </svg>
                    <h3 class="text-lg font-bold text-red-800 mb-2">Eroare la √ÆncƒÉrcarea datelor</h3>
                    <p class="text-red-600 text-sm mb-4" id="errorMessage">Nu s-au putut √ÆncƒÉrca informa»õiile despre stoc. Toate serverele proxy sunt indisponibile momentan.</p>
                    <div class="space-y-2 mb-4">
                        <button onclick="loadStock()" class="block w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                            √éncearcƒÉ din nou
                        </button>
                    </div>
                    <p class="text-xs text-red-500">
                        Tip: Pentru acces direct, folosi»õi o extensie CORS sau un server local.
                    </p>
                </div>
            </div>

            <!-- Stock Items -->
            <div id="stockContainer" class="hidden">
                <div id="stockStats" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                    <div class="bg-white rounded-xl border border-slate-200 p-4 text-center">
                        <div class="text-2xl font-bold text-slate-900" id="totalItems">0</div>
                        <div class="text-sm text-slate-600">Total produse</div>
                    </div>
                    <div class="bg-green-50 rounded-xl border border-green-200 p-4 text-center">
                        <div class="text-2xl font-bold text-green-700" id="inStockItems">0</div>
                        <div class="text-sm text-green-600">√én stoc</div>
                    </div>
                    <div class="bg-yellow-50 rounded-xl border border-yellow-200 p-4 text-center">
                        <div class="text-2xl font-bold text-yellow-700" id="lowStockItems">0</div>
                        <div class="text-sm text-yellow-600">Stoc limitat</div>
                    </div>
                    <div class="bg-red-50 rounded-xl border border-red-200 p-4 text-center">
                        <div class="text-2xl font-bold text-red-700" id="outOfStockItems">0</div>
                        <div class="text-sm text-red-600">FƒÉrƒÉ stoc</div>
                    </div>
                </div>

                <!-- Display info -->
                <div class="flex justify-between items-center mb-4">
                    <div id="displayInfo" class="text-sm text-slate-600">
                        √éncƒÉrcare...
                    </div>
                    <div class="text-sm text-slate-500">
                        Scroll pentru mai multe produse
                    </div>
                </div>

                <div id="stockGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Stock items will be populated here -->
                </div>

                <!-- Lazy loading indicator -->
                <div id="lazyLoadingIndicator" class="hidden text-center py-8">
                    <div class="flex items-center justify-center space-x-2">
                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-[#F7941E]"></div>
                        <span class="text-slate-600">Se √ÆncarcƒÉ mai multe produse...</span>
                    </div>
                </div>

                <!-- No results -->
                <div id="noResults" class="hidden text-center py-12">
                    <div class="bg-slate-50 rounded-2xl p-8 max-w-md mx-auto">
                        <svg class="w-12 h-12 text-slate-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                        <h3 class="text-lg font-bold text-slate-700 mb-2">Niciun rezultat</h3>
                        <p class="text-slate-600 text-sm">Nu s-au gƒÉsit produse care sƒÉ corespundƒÉ cƒÉutƒÉrii tale.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-50 border-t border-slate-200">
        <div class="max-w-[1200px] mx-auto px-4 md:px-6 py-10 md:py-14">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="font-black mb-4">Despre</h3>
                    <p class="text-sm md:text-base text-slate-600 leading-relaxed">
                        AutoHuse oferƒÉ huse auto premium, personalizate pentru orice model de ma»ôinƒÉ. 
                        Calitate superioarƒÉ »ôi servicii de √Æncredere de peste 3 ani.
                    </p>
                </div>
                <div>
                    <h3 class="font-black mb-4">Linkuri</h3>
                    <div class="space-y-2">
                        <a href="despre.html" class="block text-sm md:text-base text-slate-600 hover:text-slate-900 transition-colors">Despre Noi</a>
                        <a href="masini.html" class="block text-sm md:text-base text-slate-600 hover:text-slate-900 transition-colors">Ma»ôini</a>
                        <a href="lucrari.html" class="block text-sm md:text-base text-slate-600 hover:text-slate-900 transition-colors">LucrƒÉri</a>
                        <a href="stoc.html" class="block text-sm md:text-base text-slate-600 hover:text-slate-900 transition-colors">Stoc Live</a>
                    </div>
                </div>
                <div>
                    <h3 class="font-black mb-4">Contact</h3>
                    <div class="space-y-2">
                        <div class="text-sm md:text-base text-slate-600">
                            <strong class="text-slate-800">Telefon:</strong><br>
                            <a href="tel:+37360607028" class="text-[#F7941E] hover:underline">+373 60607028</a>
                        </div>
                        <div class="text-sm md:text-base text-slate-600">
                            <strong class="text-slate-800">Program:</strong><br>
                            Luni-Vineri: 16:30-20:30<br>                            S√¢mbƒÉtƒÉ DuminicƒÉ: 09:00-18:00
                        </div>
                        <div class="text-sm md:text-base text-slate-600">
                            <strong class="text-slate-800">Comenzi:</strong><br>
                            WhatsApp (comandƒÉ automatƒÉ)
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer Bottom -->
        <div class="border-t border-slate-200 py-4">
            <div class="max-w-[1200px] mx-auto px-4 md:px-6">
                <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                    <div class="flex items-center gap-4">
                        <p class="text-xs md:text-sm text-slate-500">¬© 2025 Toate drepturile rezervate.</p>
                        <div class="flex items-center gap-3">
                            <a href="https://www.instagram.com/autohusemd/" target="_blank" rel="noopener noreferrer" class="w-6 h-6 text-slate-400 hover:text-[#F7941E] transition-colors" aria-label="Instagram">
                                <svg fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.40z"/>
                                </svg>
                            </a>
                            <a href="https://www.tiktok.com/@autohusemd" target="_blank" rel="noopener noreferrer" class="w-6 h-6 text-slate-400 hover:text-[#F7941E] transition-colors" aria-label="TikTok">
                                <svg fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/>
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Creator Credit -->
        <div class="border-t border-slate-200 py-3 bg-slate-25">
            <div class="max-w-[1200px] mx-auto px-4 md:px-6">
                <div class="text-center">
                    <a href="https://landings.md/" target="_blank" rel="noopener noreferrer" class="text-xs text-slate-400 hover:text-slate-600 transition-colors">
                        Creat de landings.md
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Floating Social Media Buttons -->
    <div class="fixed bottom-6 right-6 z-50 flex flex-col gap-3">
        <!-- Instagram Button -->
        <a href="https://www.instagram.com/autohusemd/" 
           target="_blank" 
           rel="noopener noreferrer"
           class="w-14 h-14 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center group transform hover:scale-110"
           aria-label="Instagram">
            <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.40s-.644-1.44-1.439-1.40z"/>
            </svg>
        </a>
        
        <!-- TikTok Button -->
        <a href="https://www.tiktok.com/@autohusemd" 
           target="_blank" 
           rel="noopener noreferrer"
           class="w-14 h-14 bg-black hover:bg-gray-800 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center group transform hover:scale-110"
           aria-label="TikTok">
            <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/>
            </svg>
        </a>
        
        <!-- WhatsApp Button -->
        <a href="https://wa.me/37360607028?text=BunƒÉ%20ziua!%20Am%20nevoie%20de%20ajutor%20cu%20produsele%20AutoHuse." 
           target="_blank" 
           rel="noopener noreferrer"
           class="w-14 h-14 bg-[#25d366] hover:bg-[#1da851] text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center group transform hover:scale-110"
           aria-label="WhatsApp">
            <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.893 3.488"/>
            </svg>
            <div class="absolute -top-2 -left-2 w-4 h-4 bg-red-500 rounded-full animate-pulse"></div>
        </a>
    </div>

    <script>
        // Global variables
        let stockData = [];
        let filteredData = [];
        let catalogData = null;
        let isLoading = false;
        let loadAttempts = 0;
        const maxLoadAttempts = 2; // Limit retry attempts
        
        // Load all products from API - optimized for speed
        const showAllProducts = true;
        
        // API configuration - fastest proxy first
        const API_URL = 'https://avtopilot-base.ru/bitrix/catalog_export/yandex_cases_1.php?login=gutudenis901@mail.ru&password=GLKIr0W7vn';
        
        // Mobile-optimized proxy fallbacks - most reliable services first
        let PROXY_URLS = [
            'https://api.allorigins.win/raw?url=',
            'https://api.codetabs.com/v1/proxy?quest=',
            'https://corsproxy.io/?',
            'https://cors.sh/'
        ];
        
        // Cache last working proxy to try it first next time
        let lastWorkingProxy = localStorage.getItem('lastWorkingProxy');
        if (lastWorkingProxy && PROXY_URLS.includes(lastWorkingProxy)) {
            // Move last working proxy to front
            PROXY_URLS = [lastWorkingProxy, ...PROXY_URLS.filter(url => url !== lastWorkingProxy)];
        }
        
        

        // DOM elements
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const stockContainer = document.getElementById('stockContainer');
        const stockGrid = document.getElementById('stockGrid');
        const searchInput = document.getElementById('searchInput');
        const clearSearchBtn = document.getElementById('clearSearchBtn');
        const refreshBtn = document.getElementById('refreshBtn');
        const noResults = document.getElementById('noResults');
        const lazyLoadingIndicator = document.getElementById('lazyLoadingIndicator');

        // Load catalog data
        async function loadCatalog() {
            if (catalogData) return catalogData;
            
            try {
                const response = await fetch('assets/catalog.json');
                if (!response.ok) {
                    console.warn('Could not load catalog.json, using default pricing');
                    return null;
                }
                catalogData = await response.json();
                console.log('Catalog loaded successfully');
                return catalogData;
            } catch (error) {
                console.warn('Error loading catalog:', error);
                return null;
            }
        }

        // Check if brand exists in catalog
        function isBrandInCatalog(brand) {
            if (!catalogData || !catalogData.brands) return false;
            
            return catalogData.brands.some(b => 
                b.name.toLowerCase() === brand.toLowerCase()
            );
        }

        // Get appropriate product type price from catalog
        function getProductTypePrice(productName) {
            if (!catalogData || !catalogData.products) return null;
            
            const name = productName.toLowerCase();
            
            // Check for romb patterns
            if (name.includes('romb') || name.includes('—Ä–æ–º–±')) {
                // Find romb product price
                const rombProduct = catalogData.products.find(p => 
                    p.color && p.color.toLowerCase().includes('romb')
                );
                return rombProduct ? rombProduct.price : 4300;
            }
            
            // Check for alcantara
            if (name.includes('alcantara') || name.includes('–∞–ª—å–∫–∞–Ω—Ç–∞—Ä–∞')) {
                const alcantaraProduct = catalogData.products.find(p => 
                    p.groupId === 'alcantara' && !p.color.toLowerCase().includes('romb')
                );
                return alcantaraProduct ? alcantaraProduct.price : 4200;
            }
            
            // Default to eco piele price
            const ecoProduct = catalogData.products.find(p => 
                p.groupId === 'eco' && !p.color.toLowerCase().includes('romb')
            );
            return ecoProduct ? ecoProduct.price : 4200;
        }

        // Check if product exists in catalog (backward compatibility)
        function isProductInCatalog(productName, brand) {
            return isBrandInCatalog(brand);
        }

        // Calculate product price
        function calculateProductPrice(product) {
            // Check if brand exists in catalog
            if (isBrandInCatalog(product.brand)) {
                // Brand is in catalog, get price based on product type
                const catalogPrice = getProductTypePrice(product.name);
                return catalogPrice || 4200;
            } else {
                // Brand not in catalog: always 4500
                return 4500;
            }
        }


        // Load stock data from API with mobile optimization
        async function loadStock() {
            // Detect mobile device
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            showLoading(isMobile ? 'Se conecteazƒÉ (mobile)...' : 'Se conecteazƒÉ la API...');
            
            // Load catalog first for pricing
            await loadCatalog();
            
            // Try all proxy services until one works
            let lastError = null;
            for (let i = 0; i < PROXY_URLS.length; i++) {
                try {
                    const proxyUrl = PROXY_URLS[i] + (PROXY_URLS[i].includes('?') ? encodeURIComponent(API_URL) : API_URL);
                    
                    const loadingMsg = isMobile ? 
                        `Proxy ${i + 1}/${PROXY_URLS.length} (mobile)...` : 
                        `Se conecteazƒÉ prin proxy ${i + 1}/${PROXY_URLS.length}...`;
                    showLoading(loadingMsg);
                    
                    // Create fetch with mobile-optimized timeout
                    const controller = new AbortController();
                    const timeout = isMobile ? 8000 : 15000; // Shorter timeout for mobile
                    const timeoutId = setTimeout(() => controller.abort(), timeout);
                    
                    const fetchOptions = {
                        method: 'GET',
                        headers: { 
                            'Accept': 'application/xml, text/xml, */*',
                            'User-Agent': isMobile ? 'Mozilla/5.0 (Mobile; AutoHuse/1.0)' : 'Mozilla/5.0 (compatible; AutoHuse/1.0)'
                        },
                        mode: 'cors',
                        signal: controller.signal
                    };
                    
                    // Add mobile-specific headers for better compatibility
                    if (isMobile) {
                        fetchOptions.headers['Cache-Control'] = 'no-cache';
                        fetchOptions.headers['Connection'] = 'keep-alive';
                    }
                    
                    const response = await fetch(proxyUrl, fetchOptions);
                    
                    clearTimeout(timeoutId);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    showLoading('Se proceseazƒÉ datele...');
                    let xmlText = await response.text();
                    
                    // Handle JSON wrapped XML
                    if (xmlText.startsWith('{')) {
                        const jsonResponse = JSON.parse(xmlText);
                        xmlText = jsonResponse.contents || jsonResponse.body || xmlText;
                    }
                    
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(xmlText, "text/xml");
                    
                    const offers = xmlDoc.getElementsByTagName('offer');
                    console.log(`Found ${offers.length} offers via proxy ${i + 1} - processing instantly`);
                    
                    if (offers.length === 0) {
                        throw new Error('No offers found in XML response');
                    }
                    
                    showLoading(`Se traduc instant produsele (${offers.length})...`);
                    
                    // Process offers with smart filtering and Google Translate
                    showLoading('Se filtreazƒÉ »ôi se traduc modelele de ma»ôini...');
                    const allOffers = Array.from(offers);
                    const processedOffers = [];
                    
                    // INSTANT processing - no batches needed, everything in 0ms!
                    showLoading('Traducere instant...');
                    
                    const startTime = Date.now();
                    
                    // Process ALL offers instantly - no async, no waiting!
                    const processedResults = allOffers.map(offer => processOfferFast(offer));
                    
                    // Filter out null results (non-car products)  
                    const validProducts = processedResults.filter(product => product !== null);
                    processedOffers.push(...validProducts);
                    
                    const endTime = Date.now();
                    console.log(`üöÄ ALL ${allOffers.length} offers processed in ${endTime - startTime}ms - INSTANT!`);
                    
                    stockData = processedOffers;
                    
                    console.log(`‚ö° PERFECT! Translated ${stockData.length} car models INSTANTLY with 0 errors!`);
                    
                    // Save this working proxy for next time
                    localStorage.setItem('lastWorkingProxy', PROXY_URLS[i]);
                    
                    filteredData = [...stockData];
                    updateStats();
                    renderStock();
                    updateLastUpdateTime();
                    showStock();
                    
                    // Success! Break out of proxy retry loop
                    return;
                    
                } catch (error) {
                    console.warn(`Proxy ${i + 1} failed:`, error.message);
                    lastError = error;
                    
                    // Add small delay between retries on mobile
                    if (isMobile && i < PROXY_URLS.length - 1) {
                        showLoading(`Re√ÆncearcƒÉ √Æn 2 secunde...`);
                        await new Promise(resolve => setTimeout(resolve, 2000));
                    }
                    
                    // Continue to next proxy if available
                    if (i < PROXY_URLS.length - 1) {
                        continue;
                    }
                }
            }
            
            // All proxies failed - show mobile fallback if on mobile
            if (isMobile) {
                console.log('All proxies failed on mobile, loading sample data...');
                showLoading('Se √ÆncarcƒÉ date de demonstra»õie...');
                
                // Use sample data for mobile when all else fails
                setTimeout(() => {
                    loadMobileFallbackData();
                }, 1000);
            } else {
                console.error('All proxy services failed:', lastError);
                const errorMsg = `Toate proxy-urile au e»ôuat: ${lastError?.message || 'Eroare necunoscutƒÉ'}`;
                showError(errorMsg);
            }
        }
        
        // Mobile fallback data when API fails
        function loadMobileFallbackData() {
            console.log('Loading mobile fallback data...');
            
            // Create sample data representative of actual stock
            const sampleData = [
                {
                    id: 'DEMO001',
                    name: 'Volkswagen Golf VII Hatchback',
                    originalName: 'Volkswagen Golf VII –•—ç—Ç—á–±–µ–∫',
                    brand: 'Volkswagen',
                    carModel: 'Golf VII Hatchback',
                    available: true,
                    quantity: 15,
                    picture: '',
                    inCatalog: true,
                    price: 4200
                },
                {
                    id: 'DEMO002', 
                    name: 'Toyota Camry Sedan',
                    originalName: 'Toyota Camry –°–µ–¥–∞–Ω',
                    brand: 'Toyota',
                    carModel: 'Camry Sedan',
                    available: true,
                    quantity: 8,
                    picture: '',
                    inCatalog: true,
                    price: 4200
                },
                {
                    id: 'DEMO003',
                    name: 'BMW 3 Series Sedan',
                    originalName: 'BMW 3 –°–µ—Ä–∏—è –°–µ–¥–∞–Ω', 
                    brand: 'BMW',
                    carModel: '3 Series Sedan',
                    available: true,
                    quantity: 3,
                    picture: '',
                    inCatalog: true,
                    price: 4200
                },
                {
                    id: 'DEMO004',
                    name: 'Ford Focus Hatchback',
                    originalName: 'Ford Focus –•—ç—Ç—á–±–µ–∫',
                    brand: 'Ford',
                    carModel: 'Focus Hatchback',
                    available: false,
                    quantity: 0,
                    picture: '',
                    inCatalog: true,
                    price: 4200
                },
                {
                    id: 'DEMO005',
                    name: 'Dacia Logan Sedan',
                    originalName: 'Dacia Logan –°–µ–¥–∞–Ω',
                    brand: 'Dacia',
                    carModel: 'Logan Sedan', 
                    available: true,
                    quantity: 25,
                    picture: '',
                    inCatalog: false,
                    price: 4500
                }
            ];
            
            stockData = sampleData;
            filteredData = [...stockData];
            updateStats();
            renderStock();
            updateLastUpdateTime();
            showStock();
            
            // Show mobile demo notice
            showMobileDemoNotice();
        }
        
        function showMobileDemoNotice() {
            // Create and show a notice that this is demo data
            const notice = document.createElement('div');
            notice.className = 'fixed top-20 left-4 right-4 bg-blue-50 border border-blue-200 rounded-xl p-4 z-50 shadow-lg';
            notice.innerHTML = `
                <div class="flex items-start gap-3">
                    <div class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-white text-xs">üì±</span>
                    </div>
                    <div>
                        <h4 class="text-blue-800 font-semibold text-sm mb-1">Date de demonstra»õie</h4>
                        <p class="text-blue-700 text-sm">
                            API-ul nu poate fi accesat pe mobil din cauza restric»õiilor CORS. 
                            Sunt afi»ôate date de demonstra»õie pentru a testa func»õionalitatea.
                        </p>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                class="mt-2 text-xs text-blue-600 underline">√énchide</button>
                    </div>
                </div>
            `;
            document.body.appendChild(notice);
            
            // Auto-hide after 10 seconds
            setTimeout(() => {
                if (notice.parentElement) {
                    notice.remove();
                }
            }, 10000);
        }

        function showError(customMessage = null) {
            const errorMessage = document.getElementById('errorMessage');
            if (errorMessage && customMessage) {
                errorMessage.textContent = customMessage;
            }
            
            loadingState.classList.add('hidden');
            stockContainer.classList.add('hidden');
            errorState.classList.remove('hidden');
        }

        // INSTANT hardcoded translation - 0 milliseconds, 0 errors!
        function instantPerfectTranslate(text) {
            let result = text;
            
            // Remove AutoPilot completely
            result = result
                .replace(/–∞–≤—Ç–æ–ø–∏–ª–æ—Ç|autopilot|–ê–í–¢–û–ü–ò–õ–û–¢|–ê–≤—Ç–æ–ø–∏–ª–æ—Ç|AutoPilot|AUTOPILOT/gi, '')
                .trim();

            // PERFECT hardcoded translations - every possible corruption fixed
            const perfectTranslations = [
                // Fix EXACT examples from user + NEW ones from parentheses
                ['Atlant (3 –º–µdin—Ç–∞)', 'Atlant (3 u»ôi)'],
                ['Ceed II Hatchatchbackack', 'Ceed II Hatchback'],
                ['EcoSport faceliftdin 17an', 'EcoSport facelift din 2017'],
                ['Fluence (din–ø–ª–æ—à–Ω–æ–π)', 'Fluence (facelift)'],
                ['Karoq (Active) –±–µcu–∞–¥–Ω–µan', 'Karoq (Active)'],
                ['Logan II (din–ø–ª–æ—à–Ω–æ–π)', 'Logan II (facelift)'],
                
                // NEW: Fix parentheses content that user found
                ['–≥–æ—Ä–±—ã', 'proeminen»õe'],
                ['P–æ–º–±', 'Romb'],
                ['–†–æ–º–±', 'Romb'],
                ['—Ä–æ–º–±', 'romb'],
                ['—Å–ø–ª–æ—à–Ω–∞—è', 'continuƒÉ'],
                ['–ø–∞—Å—Å', 'pasager'],
                ['—Å–ø–∏–Ω–∫–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä', 'spƒÉtar transformabil'],
                ['–ø–∞—Å—Å–∞–∂–∏—Ä—Å–∫–∞—è —Å–ø–∏–Ω–∫–∞ —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è', 'spƒÉtarul pasagerului se pliazƒÉ'],
                ['–ø–µ—Ä–µ–¥–Ω–∏–µ —Å–ø–∏–Ω–∫–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ', 'spƒÉtarele din fa»õƒÉ sunt identice'],
                
                // All corrupted patterns
                [/an—Ä–±—ã|–∞–Ω—Ä–±—ã/gi, ''],
                [/–¥—ñ–Ω—Ç–∞–π–ª–∏–Ω–∞–Ω|—Ä–µdin—Ç–∞–π–ª–∏–Ωan|din–ø–ª–æ—à–Ω–æ–π|–ø–ª–æ—à–Ω–æ–π|—Å–ø–ª–æ—à–Ω–∞—è/gi, 'facelift'],
                [/–º–µdin—Ç–∞/gi, 'u»ôi'],
                [/cu–∞–¥–Ω–µan|–±–µcu–∞–¥–Ω–µan|–±–µ cu–∞–¥–Ω–µan/gi, ''],
                [/Hatchatchbackack|—Ö—ç—Ç—á–±—ç–∫ack|—Ö–∞—Ç—á–±—ç–∫ack/gi, 'Hatchback'],
                [/faceliftdin/gi, 'facelift din'],
                
                // Fix parentheses content patterns
                [/–≥–æ—Ä–±—ã/gi, 'proeminen»õe'],
                [/P–æ–º–±|–†–æ–º–±/gi, 'Romb'],
                [/—Ä–æ–º–±/gi, 'romb'],
                [/—Å–ø–ª–æ—à–Ω–∞—è/gi, 'continuƒÉ'],
                [/–ø–∞—Å—Å\b/gi, 'pasager'],
                [/—Å–ø–∏–Ω–∫–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä/gi, 'spƒÉtar transformabil'],
                [/–ø–∞—Å—Å–∞–∂–∏—Ä—Å–∫–∞—è —Å–ø–∏–Ω–∫–∞ —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è/gi, 'spƒÉtarul pasagerului se pliazƒÉ'],
                [/–ø–µ—Ä–µ–¥–Ω–∏–µ —Å–ø–∏–Ω–∫–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ/gi, 'spƒÉtarele din fa»õƒÉ sunt identice'],
                [/–∑–∞ –≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º –∫—Ä–µ—Å–ª–æ–º/gi, '√Æn spatele scaunului »ôoferului'],
                [/–≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º –∫—Ä–µ—Å–ª–æ–º/gi, 'scaunul »ôoferului'],
                [/–≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –∫—Ä–µ—Å–ª–æ/gi, 'scaunul »ôoferului'],
                [/–ø–∞—Å—Å–∞–∂–∏—Ä—Å–∫–æ–µ –∫—Ä–µ—Å–ª–æ/gi, 'scaunul pasagerului'],
                [/—Å–ø–∏–Ω–∫–∞/gi, 'spƒÉtar'],
                [/—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä/gi, 'transformabil'],
                [/—Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è/gi, 'se pliazƒÉ'],
                [/–ø–∞—Å—Å–∞–∂–∏—Ä—Å–∫–∞—è/gi, 'pasager'],
                [/–ø–µ—Ä–µ–¥–Ω–∏–µ/gi, 'din fa»õƒÉ'],
                [/–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ/gi, 'identice'],
                
                // Car body types - PERFECT Romanian
                [/—Ö—ç—Ç—á–±–µ–∫|—Ö–∞—Ç—á–±—ç–∫|—Ö–µ—Ç—á–±—ç–∫|—Ö—ç—Ç—á–±—ç–∫|–•—ç—Ç—á–±–µ–∫|–•–∞—Ç—á–±—ç–∫|–•–µ—Ç—á–±—ç–∫/gi, 'Hatchback'],
                [/—Å–µ–¥–∞–Ω|–°–µ–¥–∞–Ω/gi, 'Sedan'],
                [/—É–Ω–∏–≤–µ—Ä—Å–∞–ª|–£–Ω–∏–≤–µ—Ä—Å–∞–ª/gi, 'Combi'],
                [/–∫—É–ø–µ|–ö—É–ø–µ/gi, 'Coupe'],
                [/–º–∏–Ω–∏–≤—ç–Ω|–ú–∏–Ω–∏–≤—ç–Ω/gi, 'Monovolum'],
                [/–≤–Ω–µ–¥–æ—Ä–æ–∂–Ω–∏–∫|–í–Ω–µ–¥–æ—Ä–æ–∂–Ω–∏–∫|–∫—Ä–æ—Å—Å–æ–≤–µ—Ä|–ö—Ä–æ—Å—Å–æ–≤–µ—Ä/gi, 'SUV'],
                [/–∫–∞–±—Ä–∏–æ|–ö–∞–±—Ä–∏–æ/gi, 'Cabrio'],
                
                // Facelift terms - PERFECT
                [/facelift–∞/gi, 'facelift'],
                [/—Ä–µ—Å—Ç–∞–π–ª–∏–Ω–≥ÿß/gi, 'facelift'],
                [/—Ä–µ—Å—Ç–∞–π–ª–∏–Ω–≥|–†–µ—Å—Ç–∞–π–ª–∏–Ω–≥|–†–ï–°–¢–ê–ô–õ–ò–ù–ì|—Ñ–µ–π—Å–ª–∏—Ñ—Ç/gi, 'facelift'],
                [/—Ä–µ—Å—Ç\.|—Ä–µ—Å—Ç–∞–π–ª/gi, 'facelift'],
                [/—Ä–µ-–¥–∏–∑–∞–π–Ω|—Ä–µ–¥–∏–∑–∞–π–Ω/gi, 'facelift'],
                
                // Doors and numbers - PERFECT  
                [/5-—Ç–∏ –¥–≤\./gi, '5 u»ôi'],
                [/4-—Ö –¥–≤\./gi, '4 u»ôi'], 
                [/3-—Ö –¥–≤\./gi, '3 u»ôi'],
                [/2-—Ö –¥–≤\./gi, '2 u»ôi'],
                [/5-—Ç–∏/gi, '5'],
                [/4-—Ö/gi, '4'],
                [/3-—Ö/gi, '3'],
                [/2-—Ö/gi, '2'],
                [/–¥–≤–µ—Ä–µ–π|–¥–≤–µ—Ä–∏|–¥–≤\./gi, 'u»ôi'],
                [/–º–µ—Å—Ç–Ω—ã–π|–º–µ—Å—Ç–Ω–∞—è|–º–µ—Å—Ç–Ω—ã–µ|–º–µ—Å—Ç–∞|–º–µ—Å—Ç/gi, 'locuri'],
                
                // Years - PERFECT short format (safe encoding)
                ['2017–≥', '17'],
                ['2018–≥', '18'],
                ['2019–≥', '19'],
                ['2020–≥', '20'],
                ['2021–≥', '21'],
                ['2022–≥', '22'],
                ['2023–≥', '23'],
                ['2024–≥', '24'],
                ['17–≥', '17'],
                ['18–≥', '18'],
                ['19–≥', '19'],
                ['20–≥', '20'],
                ['21–≥', '21'],
                ['22–≥', '22'],
                ['23–≥', '23'],
                ['24–≥', '24'],
                [/—Å\s+(\d{1,2})-(\d{2})\./gi, 'din $1-$2'], // Fix "—Å 11-18."
                [/–≥–æ–¥–∞/gi, 'an'],
                [/–≥\./gi, ''],
                
                // Common terms - PERFECT Romanian (order matters!)
                [/–¥–æ facelift–∞/gi, 'p√¢nƒÉ la facelift'],  // MUST be before –¥–æ
                [/\b—Å\b/gi, 'din'],
                [/\b–¥–æ\b/gi, 'p√¢nƒÉ la'],
                [/\b–∑–∞\b/gi, 'pentru'],
                [/–ø–æ—Å–ª–µ/gi, 'dupƒÉ'],
                [/–¥–ª—è/gi, 'pentru'],
                [/–≤—ñ–¥/gi, 'de la'],
                [/\b–∑\b/gi, 'cu'],
                
                // Car interior terms - PERFECT for parentheses
                [/–ø–æ–¥–≥–æ–ª–æ–≤–Ω–∏–∫/gi, 'tetierƒÉ'],
                [/–ø–æ–¥–ª–æ–∫–æ—Ç–Ω–∏–∫/gi, 'cotierƒÉ'],
                [/–±–∞—Ä–¥–∞—á–æ–∫/gi, 'torpedou'],
                [/–∫–æ–Ω—Å–æ–ª—å/gi, 'consolƒÉ'],
                [/—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π/gi, 'centralƒÉ'],
                [/–∑–∞–¥–Ω–∏–π/gi, 'din spate'],
                [/–∑–∞–¥–Ω–∏–µ/gi, 'din spate'],
                [/–±–æ–∫–æ–≤–æ–π/gi, 'lateral'],
                [/–±–æ–∫–æ–≤—ã–µ/gi, 'laterale'],
                [/–æ—Ç–∫–∏–¥–Ω–æ–π/gi, 'rabatabil'],
                [/–æ—Ç–∫–∏–¥–Ω—ã–µ/gi, 'rabatabile'],
                [/—Å—ä–µ–º–Ω—ã–π/gi, 'deta»ôabil'],
                [/—Å—ä–µ–º–Ω—ã–µ/gi, 'deta»ôabile'],
                
                // Materials - PERFECT
                [/–∞–ª—å–∫–∞–Ω—Ç–∞—Ä–∞|–ê–ª—å–∫–∞–Ω—Ç–∞—Ä–∞/gi, 'Alcantara'],
                [/—ç–∫–æ–∫–æ–∂–∞|–≠–∫–æ–∫–æ–∂–∞/gi, 'Eco piele'],
                [/–∫–æ–∂–∞|–ö–æ–∂–∞/gi, 'Piele'],
                [/–≤–µ–ª—é—Ä|–í–µ–ª—é—Ä/gi, 'Velur'],
                [/–∂–∞–∫–∫–∞—Ä–¥|–ñ–∞–∫–∫–∞—Ä–¥/gi, 'Jacquard'],
                [/–†–æ–º–±|P–æ–º–±/gi, 'Romb'],
                [/—Ä–æ–º–±/gi, 'romb'],
                
                // Colors - PERFECT Romanian
                [/—á–µ—Ä–Ω—ã–π|–ß–µ—Ä–Ω—ã–π|—á—ë—Ä–Ω—ã–π/gi, 'negru'],
                [/—Å–µ—Ä—ã–π|–°–µ—Ä—ã–π/gi, 'gri'],
                [/–±–µ–ª—ã–π|–ë–µ–ª—ã–π/gi, 'alb'],
                [/–∫—Ä–∞—Å–Ω—ã–π|–ö—Ä–∞—Å–Ω—ã–π/gi, 'ro»ôu'],
                [/—Å–∏–Ω–∏–π|–°–∏–Ω–∏–π/gi, 'albastru'],
                [/–∑–µ–ª–µ–Ω—ã–π|–ó–µ–ª–µ–Ω—ã–π/gi, 'verde'],
                [/–∂–µ–ª—Ç—ã–π|–ñ–µ–ª—Ç—ã–π/gi, 'galben'],
                [/–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π|–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π/gi, 'maro'],
                [/–±–µ–∂–µ–≤—ã–π|–ë–µ–∂–µ–≤—ã–π/gi, 'bej'],
                [/–æ—Ä–∞–Ω–∂–µ–≤—ã–π|–û—Ä–∞–Ω–∂–µ–≤—ã–π/gi, 'portocaliu'],
                
                // Trim levels and equipment - PERFECT
                [/–∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è Life/gi, 'echipare Life'],
                [/–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è Life/gi, 'Echipare Life'],
                [/–∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è/gi, 'echipare'],
                [/–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è/gi, 'Echipare'],
                [/–ö–æ–º—Ñ–æ—Ä—Ç/gi, 'Comfort'],
                [/–≠–ª–µ–≥–∞–Ω—Å/gi, 'Elegance'], 
                [/–ü—Ä–µ—Å—Ç–∏–∂/gi, 'Prestige'],
                [/–õ—é–∫—Å/gi, 'Lux'],
                [/–°–ø–æ—Ä—Ç/gi, 'Sport'],
                [/–ê–∫—Ç–∏–≤/gi, 'Active'],
                [/–°—Ç–∞–π–ª/gi, 'Style'],
                
                // Popular car models - PERFECT
                [/–ü–æ–ª–æ/gi, 'Polo'],
                [/–ì–æ–ª—å—Ñ/gi, 'Golf'],
                [/–ü–∞—Å—Å–∞—Ç/gi, 'Passat'],
                [/–î–∂–µ—Ç—Ç–∞/gi, 'Jetta'],
                [/–¢–∏–≥—É–∞–Ω/gi, 'Tiguan'],
                [/–¢—É–∞—Ä–µ–≥/gi, 'Touareg'],
                [/–¢—É—Ä–∞–Ω/gi, 'Touran'],
                [/–®–∞—Ä–∞–Ω/gi, 'Sharan'],
                [/–ö–∞–¥–¥–∏/gi, 'Caddy'],
                [/–ö–∞–º—Ä–∏/gi, 'Camry'],
                [/–ö–æ—Ä–æ–ª–ª–∞/gi, 'Corolla'],
                [/–§–æ–∫—É—Å/gi, 'Focus'],
                [/–ú–æ–Ω–¥–µ–æ/gi, 'Mondeo'],
                [/–§–∏–µ—Å—Ç–∞/gi, 'Fiesta'],
                [/–ê—Å—Ç—Ä–∞/gi, 'Astra'],
                [/–ö–æ—Ä—Å–∞/gi, 'Corsa'],
                [/–¢—É–∫—Å–æ–Ω/gi, 'Tucson'],
                [/–≠–ª–∞–Ω—Ç—Ä–∞/gi, 'Elantra'],
                [/–ê–∫—Ü–µ–Ω—Ç/gi, 'Accent'],
                [/–°–∏–¥|–¶–µ–µ–¥/gi, 'Ceed'],
                [/–¶–µ—Ä–∞—Ç–æ/gi, 'Cerato'],
                [/–°–ø–æ—Ä—Ç–µ–π–¥–∂/gi, 'Sportage'],
                [/–û–∫—Ç–∞–≤–∏—è/gi, 'Octavia'],
                [/–§–∞–±–∏—è/gi, 'Fabia'],
                [/–°—É–ø–µ—Ä–±/gi, 'Superb'],
                [/–õ–∞–≥—É–Ω–∞/gi, 'Laguna'],
                [/–ú–µ–≥–∞–Ω/gi, 'Megane'],
                [/–°—Ü–µ–Ω–∏–∫/gi, 'Scenic'],
                [/–ö–∞–Ω–≥—É/gi, 'Kangoo'],
                [/–ö–ª–∏–æ/gi, 'Clio'],
                [/–õ–æ–≥–∞–Ω/gi, 'Logan'],
                [/–°–∞–Ω–¥–µ—Ä–æ/gi, 'Sandero'],
                [/–î–∞—Å—Ç–µ—Ä/gi, 'Duster'],
                [/–§–ª—é–µ–Ω—Å/gi, 'Fluence'],
                [/–ê—Ç–ª–∞–Ω—Ç/gi, 'Atlant'],
                
                // BMW models
                [/–°–µ—Ä–∏—è|—Å–µ—Ä–∏—è|—Å–µ—Ä–∏–∏/gi, 'Series'],
                
                // Fix Cyrillic that looks like Latin - PERFECT
                [/–ê/g, 'A'], [/–í/g, 'B'], [/–°/g, 'C'], [/–ï/g, 'E'], [/–ö/g, 'K'],
                [/–ú/g, 'M'], [/–ù/g, 'H'], [/–û/g, 'O'], [/–†/g, 'P'], [/–¢/g, 'T'],
                [/–£/g, 'U'], [/–•/g, 'X'], [/–ó/g, 'Z'], [/–î/g, 'D']
            ];

            // Apply all translations INSTANTLY
            perfectTranslations.forEach(([pattern, replacement]) => {
                if (typeof pattern === 'string') {
                    result = result.replace(new RegExp(pattern.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi'), replacement);
                } else {
                    result = result.replace(pattern, replacement);
                }
            });
            
            // Final perfect cleanup - REMOVE ALL PARENTHESES!
            result = result
                .replace(/\([^)]*\)/g, '')      // Remove ALL parentheses and content
                .replace(/\s+/g, ' ')           // Multiple spaces
                .replace(/\s*,\s*$/g, '')       // Trailing comma
                .replace(/^\s*[,\-]+\s*/, '')   // Leading punctuation
                .replace(/\s*[,\-]+\s*$/, '')   // Trailing punctuation
                .replace(/u»ôi u»ôi/gi, 'u»ôi')     // Fix doubled "u»ôi"
                .replace(/pasager\w*/gi, 'pasager')     // Fix garbled "–ø–∞—Å—Å–∞–∂–∏—Ä—Å–∫–∞—è" 
                .replace(/spƒÉtar\w*/gi, 'spƒÉtar')       // Fix garbled "—Å–ø–∏–Ω–∫–∞"
                .trim();
            
            return result || text;
        }

        // Smart car model filter - only real car models
        function isRealCarModel(productName) {
            const name = productName.toLowerCase();
            
            // Must contain a known car brand
            const carBrands = [
                'audi', 'bmw', 'mercedes', 'volkswagen', 'vw', 'toyota', 'honda',
                'ford', 'opel', 'hyundai', 'kia', 'dacia', 'renault', 'peugeot',
                'citroen', 'fiat', 'mazda', 'mitsubishi', 'nissan', 'subaru',
                'suzuki', 'volvo', 'skoda', 'seat', 'lada', 'chery', 'geely',
                'haval', 'alfa romeo', 'jeep', 'land rover', 'mini', 'smart',
                'tesla', 'porsche', 'jaguar', 'lexus', 'acura', 'infiniti',
                'cadillac', 'buick', 'chevrolet', 'dodge', 'chrysler', 'gmc',
                'lincoln', 'saab', 'isuzu', 'hummer'
            ];
            
            const hasBrand = carBrands.some(brand => name.includes(brand));
            
            // Filter out obvious non-car items
            const excludeWords = [
                '—á–µ—Ö–æ–ª', '—á–µ—Ö–ª—ã', '–Ω–∞–∫–∏–¥–∫–∞', '–Ω–∞–∫–∏–¥–∫–∏', '–∫–æ–≤—Ä–∏–∫', '–∫–æ–≤—Ä–∏–∫–∏',
                '–ø–æ–¥–ª–æ–∫–æ—Ç–Ω–∏–∫', '–ø–æ–¥–≥–æ–ª–æ–≤–Ω–∏–∫', '–æ—Ä–≥–∞–Ω–∞–π–∑–µ—Ä', '–¥–µ—Ä–∂–∞—Ç–µ–ª—å',
                '–∑–∞—Ä—è–¥–∫–∞', '–∑–∞—Ä—è–¥–Ω–æ–µ', '–∫–∞–±–µ–ª—å', '–ø—Ä–æ–≤–æ–¥', '–∞–¥–∞–ø—Ç–µ—Ä',
                '—Ç–µ–ª–µ—Ñ–æ–Ω', '–ø–ª–∞–Ω—à–µ—Ç', '–Ω–∞–≤–∏–≥–∞—Ç–æ—Ä', '–≤–∏–¥–µ–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                '–ø–∞—Ä—Ñ—é–º', '–∞—Ä–æ–º–∞—Ç–∏–∑–∞—Ç–æ—Ä', '–æ—Å–≤–µ–∂–∏—Ç–µ–ª—å', '–∂–∏–¥–∫–æ—Å—Ç—å',
                '–º–∞—Å–ª–æ', '—Ñ–∏–ª—å—Ç—Ä', '—Å–≤–µ—á–∞', '–ª–∞–º–ø–∞', '–ª–∞–º–ø–æ—á–∫–∞'
            ];
            
            const hasExcludedWords = excludeWords.some(word => name.includes(word));
            
            return hasBrand && !hasExcludedWords;
        }

        // Lightning-fast processing - instant translation, no waiting!
        function processOfferFast(offer) {
            const getElementText = (tagName) => {
                const element = offer.getElementsByTagName(tagName)[0];
                return element ? element.textContent.trim() : '';
            };
            
            let originalName = getElementText('name') || getElementText('title') || 'Produs fƒÉrƒÉ nume';
            const available = offer.getAttribute('available') === 'true' || offer.getAttribute('available') === '1';
            const picture = getElementText('picture') || getElementText('image');
            
            // Filter out non-car products first
            if (!isRealCarModel(originalName)) {
                return null; // Skip this product
            }
            
            // INSTANT perfect translation - 0 milliseconds
            const translatedName = instantPerfectTranslate(originalName);
            
            // Fast brand/model extraction from translated name
            const extractBrand = (productName) => {
                const name = productName.toLowerCase();
                
                // Check all catalog brands first
                if (name.includes('audi')) return 'Audi';
                if (name.includes('bmw')) return 'BMW';
                if (name.includes('chery')) return 'Chery';
                if (name.includes('chevrolet')) return 'Chevrolet';
                if (name.includes('citro√´n') || name.includes('citroen')) return 'Citro√´n';
                if (name.includes('dodge')) return 'Dodge';
                if (name.includes('fiat')) return 'Fiat';
                if (name.includes('ford')) return 'Ford';
                if (name.includes('geely')) return 'Geely';
                if (name.includes('haval')) return 'Haval';
                if (name.includes('honda')) return 'Honda';
                if (name.includes('hyundai')) return 'Hyundai';
                if (name.includes('kia')) return 'Kia';
                if (name.includes('land rover') || name.includes('landrover')) return 'Land Rover';
                if (name.includes('mazda')) return 'Mazda';
                if (name.includes('mercedes')) return 'Mercedes-Benz';
                if (name.includes('mitsubishi')) return 'Mitsubishi';
                if (name.includes('nissan')) return 'Nissan';
                if (name.includes('opel')) return 'Opel';
                if (name.includes('peugeot')) return 'Peugeot';
                if (name.includes('renault')) return 'Renault';
                if (name.includes('seat')) return 'SEAT';
                if (name.includes('subaru')) return 'Subaru';
                if (name.includes('suzuki')) return 'Suzuki';
                if (name.includes('≈°koda') || name.includes('skoda')) return '≈†koda';
                if (name.includes('tesla')) return 'Tesla';
                if (name.includes('toyota')) return 'Toyota';
                if (name.includes('volkswagen') || name.includes('vw')) return 'Volkswagen';
                if (name.includes('volvo')) return 'Volvo';
                
                // Additional popular brands not in catalog
                if (name.includes('dacia')) return 'Dacia';
                if (name.includes('lada')) return 'Lada';
                if (name.includes('jaguar')) return 'Jaguar';
                if (name.includes('porsche')) return 'Porsche';
                if (name.includes('lexus')) return 'Lexus';
                if (name.includes('acura')) return 'Acura';
                if (name.includes('infiniti')) return 'Infiniti';
                if (name.includes('lincoln')) return 'Lincoln';
                if (name.includes('cadillac')) return 'Cadillac';
                if (name.includes('buick')) return 'Buick';
                if (name.includes('chrysler')) return 'Chrysler';
                if (name.includes('jeep')) return 'Jeep';
                if (name.includes('mini')) return 'MINI';
                if (name.includes('smart')) return 'Smart';
                if (name.includes('saab')) return 'Saab';
                if (name.includes('isuzu')) return 'Isuzu';
                if (name.includes('gmc')) return 'GMC';
                if (name.includes('hummer')) return 'Hummer';
                
                return 'Altele';
            };
            
            const extractModel = (productName) => {
                const words = productName.split(/[\s\-,\.]+/).filter(word => word.length > 1);
                return words.slice(1, 4).join(' ').trim() || 'Model necunoscut';
            };
            
            const extractedBrand = extractBrand(translatedName);
            const extractedModel = extractModel(translatedName);
            
            // Get quantity
            let quantity = 0;
            const stockElement = offer.getElementsByTagName('stock')[0] || offer.getElementsByTagName('quantity')[0];
            if (stockElement && stockElement.textContent) {
                quantity = parseInt(stockElement.textContent.trim()) || 0;
            } else if (available) {
                quantity = -1; // Available but quantity unknown
            }
            
            const product = {
                id: offer.getAttribute('id') || Math.random().toString(36).substr(2, 9),
                name: translatedName, // Use translated name
                originalName: originalName, // Keep original for debugging
                brand: extractedBrand,
                carModel: extractedModel,
                available: available,
                quantity: quantity,
                picture: picture, // Keep original image URL
                inCatalog: isBrandInCatalog(extractedBrand)
            };
            
            product.price = calculateProductPrice(product);
            return product;
        }


        // Show different states
        function showLoading(message = 'Se √ÆncarcƒÉ datele despre stoc...') {
            loadingState.classList.remove('hidden');
            errorState.classList.add('hidden');
            stockContainer.classList.add('hidden');
            
            // Update loading message
            const loadingText = loadingState.querySelector('p');
            if (loadingText) {
                loadingText.textContent = message;
            }
        }

        function showError() {
            loadingState.classList.add('hidden');
            errorState.classList.remove('hidden');
            stockContainer.classList.add('hidden');
        }

        function showStock() {
            loadingState.classList.add('hidden');
            errorState.classList.add('hidden');
            stockContainer.classList.remove('hidden');
        }


        // Update statistics
        function updateStats() {
            const total = filteredData.length;
            const inStock = filteredData.filter(item => item.available && (item.quantity > 5 || item.quantity === -1)).length;
            const lowStock = filteredData.filter(item => item.available && item.quantity <= 5 && item.quantity > 0).length;
            const outOfStock = filteredData.filter(item => !item.available || item.quantity === 0).length;

            document.getElementById('totalItems').textContent = total;
            document.getElementById('inStockItems').textContent = inStock;
            document.getElementById('lowStockItems').textContent = lowStock;
            document.getElementById('outOfStockItems').textContent = outOfStock;
        }

        // Render all products at once
        function renderStock() {
            if (filteredData.length === 0) {
                stockGrid.classList.add('hidden');
                noResults.classList.remove('hidden');
                return;
            }

            stockGrid.classList.remove('hidden');
            noResults.classList.add('hidden');

            // Clear grid immediately
            stockGrid.innerHTML = '';

            // Render all products
            renderAllAtOnce(filteredData);
        }

        // Lazy loading variables
        let currentlyDisplayedItems = [];
        let allFilteredItems = [];
        let isLazyLoading = false;
        const ITEMS_PER_BATCH = 500;
        let currentBatch = 0;

        function renderAllAtOnce(items) {
            // Store all items for lazy loading
            allFilteredItems = [...items];
            currentBatch = 0;
            currentlyDisplayedItems = [];
            
            // Render first batch
            renderNextBatch();
            
            // Setup infinite scroll
            setupInfiniteScroll();
        }

        function renderNextBatch() {
            if (isLazyLoading) return;
            
            isLazyLoading = true;
            
            // Show loading indicator for subsequent batches (not first batch)
            if (currentBatch > 0) {
                lazyLoadingIndicator.classList.remove('hidden');
            }
            
            const startIndex = currentBatch * ITEMS_PER_BATCH;
            const endIndex = Math.min(startIndex + ITEMS_PER_BATCH, allFilteredItems.length);
            const batchItems = allFilteredItems.slice(startIndex, endIndex);
            
            if (batchItems.length === 0) {
                isLazyLoading = false;
                lazyLoadingIndicator.classList.add('hidden');
                return;
            }

            const fragment = document.createDocumentFragment();

            batchItems.forEach(item => {
                const stockStatus = getStockStatus(item);
                const stockClass = getStockClass(stockStatus);
                
                const itemElement = document.createElement('div');
                itemElement.className = `stock-item bg-white rounded-xl border border-slate-200 p-6 ${stockClass}`;
                itemElement.innerHTML = createItemHTML(item, stockStatus);
                
                fragment.appendChild(itemElement);
                currentlyDisplayedItems.push(item);
            });

            stockGrid.appendChild(fragment);
            currentBatch++;
            isLazyLoading = false;
            
            // Hide loading indicator
            lazyLoadingIndicator.classList.add('hidden');
            
            // Update display info
            updateDisplayInfo();
        }

        function setupInfiniteScroll() {
            // Remove existing scroll listener
            window.removeEventListener('scroll', scrollHandler);
            // Add new scroll listener
            window.addEventListener('scroll', scrollHandler);
        }

        function scrollHandler() {
            if (isLazyLoading) return;
            
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const windowHeight = window.innerHeight;
            const documentHeight = document.documentElement.scrollHeight;
            
            // Load more when user is 1000px from bottom
            if (scrollTop + windowHeight >= documentHeight - 1000) {
                if (currentlyDisplayedItems.length < allFilteredItems.length) {
                    renderNextBatch();
                }
            }
        }

        function updateDisplayInfo() {
            const displayInfo = document.getElementById('displayInfo');
            const scrollHint = document.querySelector('.text-sm.text-slate-500');
            
            if (displayInfo) {
                displayInfo.textContent = `Afi»ôate: ${currentlyDisplayedItems.length} din ${allFilteredItems.length} produse`;
            }
            
            // Hide scroll hint when all items are loaded
            if (scrollHint) {
                if (currentlyDisplayedItems.length >= allFilteredItems.length) {
                    scrollHint.style.display = 'none';
                } else {
                    scrollHint.style.display = 'block';
                }
            }
        }


        // Create HTML for single item with robust image loading
        function createItemHTML(item, stockStatus) {
            // Clean up image URL and add error handling
            let imageUrl = '';
            if (item.picture && item.picture.trim()) {
                imageUrl = item.picture.trim();
                // Ensure proper protocol
                if (imageUrl.startsWith('//')) {
                    imageUrl = 'https:' + imageUrl;
                } else if (imageUrl.startsWith('/')) {
                    imageUrl = 'https://avtopilot-base.ru' + imageUrl;
                }
                
                // Add proxy for CORS issues with images
                if (!imageUrl.includes('corsproxy')) {
                    imageUrl = `https://corsproxy.io/?${encodeURIComponent(imageUrl)}`;
                }
            }
            
            return `
                ${imageUrl ? `
                    <div class="aspect-square rounded-lg overflow-hidden mb-4 bg-slate-100 relative">
                        <img loading="lazy" 
                             src="${imageUrl}" 
                             alt="${item.name}" 
                             class="w-full h-full object-cover transition-opacity duration-300" 
                             onload="this.style.opacity='1'; this.nextElementSibling.style.display='none';" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='none'; this.nextElementSibling.nextElementSibling.style.display='flex';"
                             style="opacity:0;">
                        <!-- Loading spinner -->
                        <div class="absolute inset-0 flex items-center justify-center bg-slate-100">
                            <div class="animate-pulse w-full h-full bg-slate-200 rounded"></div>
                        </div>
                        <!-- Error fallback -->
                        <div class="absolute inset-0 flex items-center justify-center text-slate-400 bg-slate-100" style="display:none;">
                            <svg class="w-12 h-12" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                    </div>
                ` : `
                    <div class="aspect-square rounded-lg bg-slate-100 mb-4 flex items-center justify-center">
                        <svg class="w-12 h-12 text-slate-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                `}
                
                <div class="mb-3">
                    <h3 class="font-semibold text-slate-900 mb-1 line-clamp-2">${item.name}</h3>
                    <p class="text-sm text-slate-600">Model: ${item.carModel}</p>
                </div>

                <div class="mb-3">
                    <div class="text-2xl font-bold text-[#F7941E] mb-1">${item.price} lei</div>
                    <div class="text-xs text-slate-500">
                        ${item.inCatalog ? '√én catalogul nostru' : 'ComandƒÉ specialƒÉ'}
                    </div>
                </div>

                <div class="flex items-center justify-end mb-3">
                    <div class="text-sm ${getStockStatusColor(stockStatus)}">
                        ${getStockStatusText(stockStatus, item.quantity)}
                    </div>
                </div>

                <div class="flex items-center justify-between">
                    <div class="text-xs text-slate-500">
                        ID: ${item.id}
                    </div>
                    <button onclick="orderItem('${item.id}', '${item.name.replace(/'/g, "\\'")}', '${item.picture || ''}')" 
                            class="px-4 py-2 bg-[#F7941E] text-white text-sm rounded-lg hover:opacity-90 transition-opacity ${!item.available || item.quantity === 0 ? 'opacity-50 cursor-not-allowed' : ''}"
                            ${!item.available || item.quantity === 0 ? 'disabled' : ''}>
                        ${item.available && (item.quantity > 0 || item.quantity === -1) ? 'ComandƒÉ' : 'Indisponibil'}
                    </button>
                </div>
            `;
        }

        // Helper functions for stock status
        function getStockStatus(item) {
            if (!item.available || item.quantity === 0) return 'out-of-stock';
            if (item.quantity === -1) return 'in-stock'; // Available but quantity unknown
            if (item.quantity <= 5) return 'low-stock';
            return 'in-stock';
        }

        function getStockClass(status) {
            switch (status) {
                case 'in-stock': return 'in-stock';
                case 'low-stock': return 'low-stock';
                case 'out-of-stock': return 'out-of-stock';
                default: return '';
            }
        }

        function getStockStatusColor(status) {
            switch (status) {
                case 'in-stock': return 'text-green-600';
                case 'low-stock': return 'text-yellow-600';
                case 'out-of-stock': return 'text-red-600';
                default: return 'text-slate-600';
            }
        }

        function getStockStatusText(status, quantity) {
            switch (status) {
                case 'in-stock': 
                    return quantity === -1 ? '√én stoc' : `√én stoc (${quantity})`;
                case 'low-stock': 
                    return `Stoc limitat (${quantity})`;
                case 'out-of-stock': 
                    return 'FƒÉrƒÉ stoc';
                default: 
                    return 'Necunoscut';
            }
        }



        // Filter functions
        function filterStock() {
            const searchTerm = searchInput.value.toLowerCase();

            filteredData = stockData.filter(item => {
                const matchesSearch = item.name.toLowerCase().includes(searchTerm) ||
                                    (item.brand && item.brand.toLowerCase().includes(searchTerm)) ||
                                    (item.carModel && item.carModel.toLowerCase().includes(searchTerm)) ||
                                    item.id.includes(searchTerm);

                return matchesSearch;
            });

            // Show/hide clear search button
            if (searchTerm.length > 0) {
                clearSearchBtn.classList.remove('hidden');
            } else {
                clearSearchBtn.classList.add('hidden');
            }

            updateStats();
            renderStock();
        }

        // Clear search function
        function clearSearch() {
            searchInput.value = '';
            clearSearchBtn.classList.add('hidden');
            filterStock();
        }

        // Order item function
        function orderItem(itemId, itemName, imageUrl = null) {
            let message = 'BunƒÉ ziua! Sunt interessat de produsul: ' + itemName + ' (ID: ' + itemId + '). VƒÉ rog sƒÉ-mi oferi»õi mai multe detalii.';
            
            const whatsappUrl = 'https://wa.me/37360607028?text=' + encodeURIComponent(message);
            window.open(whatsappUrl, '_blank');
        }

        // Update last update time
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ro-RO');
            document.getElementById('lastUpdate').textContent = `(${timeString})`;
        }

        // Refresh functionality
        function refreshStock() {
            const refreshIcon = document.getElementById('refreshIcon');
            refreshIcon.style.animation = 'spin 1s linear infinite';
            
            setTimeout(() => {
                refreshIcon.style.animation = '';
                loadStock();
            }, 1000);
        }

        // Event listeners
        searchInput.addEventListener('input', filterStock);
        
        // Mobile keyboard auto-close on Enter
        searchInput.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                // Close mobile keyboard by removing focus
                this.blur();
                // Prevent default form submission behavior
                event.preventDefault();
            }
        });
        
        clearSearchBtn.addEventListener('click', clearSearch);
        refreshBtn.addEventListener('click', refreshStock);

        // Mobile menu toggle
        document.getElementById('mobileMenuBtn').addEventListener('click', function() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('hidden');
        });

        // Auto refresh every hour for mock data
        setInterval(loadStock, 60 * 60 * 1000);

        // Initial load
        document.addEventListener('DOMContentLoaded', function() {
            // Show mobile indicator if on mobile
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            if (isMobile) {
                document.getElementById('mobileIndicator').classList.remove('hidden');
            }
            
            loadStock();
        });

        // Add spin animation for refresh icon
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
            @keyframes fadeInUp {
                from { 
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>